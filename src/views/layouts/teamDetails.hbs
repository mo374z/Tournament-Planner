<div class="container">
    <h1>{{viewTitle}}</h1>
    <form action='/team/updateName' method="POST" autocomplete="off">
        <input type="hidden" name="_id" value="{{team._id}}">
        <div class="form-group">
            <label for="name">Name anpassen:</label>
            <input type="text" class="form-control" id="name" name="name" value="{{team.name}}" required>
        </div>
        <button type="submit" class="btn btn-primary">Name aktualisieren</button>
    </form>
    
    <hr>
    <div class="row">
        <div class="col-md-6">
            <h2 >Team Informationen</h2>
            <table class="table table-bordered table-striped" style="width: auto; margin-left: 0;">
                <tr>
                    <th>ID:</th>
                    <td style="padding-left: 20px;">{{team._id}}</td>
                </tr>
                <tr>
                    <th>Gruppe</th>
                    <td style="padding-left: 20px;">{{team.group}}</td>
                </tr>
                <tr>
                    <th>Spiele gespielt</th>
                    <td style="padding-left: 20px;">{{team.gamesPlayed}}</td>
                </tr>
                <tr>
                    <th>Spiele gewonnen</th>
                    <td style="padding-left: 20px;">{{team.gamesWon}}</td>
                </tr>
                <tr>
                    <th>Spiele verloren</th>
                    <td style="padding-left: 20px;">{{team.gamesLost}}</td>
                </tr>
                <tr>
                    <th>Spiele unentschieden</th>
                    <td style="padding-left: 20px;">{{team.gamesDraw}}</td>
                </tr>
                <tr>
                    <th>Tore Gruppenphase</th>
                    <td style="padding-left: 20px;"><strong>{{team.goalsGroupStage.[0]}}</strong> - {{team.goalsGroupStage.[1]}}</td>
                </tr>
                <tr>
                    <th>Punkte Gruppenphase</th>
                    <td style="padding-left: 20px;">{{team.points_Group_Stage}}</td>
                </tr>
                <tr>
                    <th>Tore</th>
                    <td style="padding-left: 20px;"><strong>{{team.goals.[0]}}</strong> - {{team.goals.[1]}}</td>
                </tr>
                <tr>
                    <th>Punkte Gesamt</th>
                    <td style="padding-left: 20px;">{{team.points_General}}</td>
                </tr>
                <tr>
                    <th>Sekt gewonnen</th>
                    <td style="padding-left: 20px;">{{team.sektWon}}</td>
                </tr>
                <tr>
                    <th></th>
                    <td></td>
                <tr>
                    <th>Aktueller Rang in der Gruppe</th>
                    <td style="padding-left: 20px;">{{groupRank}}</td>
                </tr>
                <tr>
                    <th>Aktueller Rang im Turnier</th>
                    <td style="padding-left: 20px;">{{tournamentRank}}</td>
                </tr>
            </table>
        </div>
        <div class="col-md-6">
            <h2 >Spieler</h2>
            <table class="table table-bordered table-striped" style="width: auto; margin-left: 0;">
                <thead>
                    <tr>
                        <th>Name</th>
                        <th>Nummer</th>
                        <th>Aktionen</th>
                    </tr>
                </thead>
                <tbody>
                    {{#each players}}
                    <tr>
                        <td style="padding-left: 20px;">{{this.name}}</td>
                        <td style="padding-left: 20px;">{{this.number}}</td>
                        <td style="padding-left: 20px;">
                            <a href="/player/{{this._id}}" class="btn btn-info">Tore anzeigen</a>
                        </td>
                    </tr>
                    {{else}}
                    <tr>
                        <td colspan="3" style="text-align: center;">Keine Spieler vorhanden</td>
                    </tr>
                    {{/each}}
                </tbody>
            </table>
            <a href="/player?teamId={{team._id}}" class="btn btn-primary">Zur Spielerverwaltung</a>
        </div>
    </div>
    <hr>
    <h2 >Kommende Spiele</h2>
    <table class="table table-bordered table-striped" style="width: auto; margin-left: 0;">
        <thead>
            <tr>
                <th>SpielNr.</th>
                <th>Uhrzeit</th>
                <th>Spiel</th>
                <th>Gegner</th>
            </tr>
        </thead>
        <tbody>
            {{#if upcomingGames.length}}
            {{#each upcomingGames}}
            <tr>
                <td style="padding-left: 20px;">{{number}}</td>
                <td style="padding-left: 20px;">{{formattedTime}}</td>
                <td style="padding-left: 20px;">{{gameDisplayName}}</td>
                <td style="padding-left: 20px;"><a href="/team/details/{{opponent.id}}" style="color: inherit;">{{opponent.name}}</a></td>
            </tr>
            {{/each}}
            {{else}}
            <tr>
                <td colspan="5" style="text-align: center;">Keine kommenden Spiele</td>
            </tr>
            {{/if}}
        </tbody>
    </table>
    <hr>
    <h2 >Bisherige Spiele von {{team.name}}</h2>
    <table class="table table-bordered table-striped" style="width: auto; margin-left: 0;">
        <thead>
            <tr>
                <th>SpielNr.</th>
                <th>Uhrzeit</th>
                <th>Spiel</th>
                <th>Gegner</th>
                <th>Sieger</th>
                <th>Endstand</th>
            </tr>
        </thead>
        <tbody>
            {{#if pastGames.length}}
            {{#each pastGames}}
            <tr>
                <td style="padding-left: 20px;">{{number}}</td>
                <td style="padding-left: 20px;">{{formattedTime}}</td>
                <td style="padding-left: 20px;">{{gameDisplayName}}</td>
                <td style="padding-left: 20px;"><a href="/team/details/{{opponent.id}}" style="color: inherit;">{{opponent.name}}</a></td>
                <td style="padding-left: 20px;">{{winner.name}}</td>
                <td style="padding-left: 20px;">
                    {{#if (eqref goals.[0] goals.[1])}}
                        {{goals.[0]}} - {{goals.[1]}}
                    {{else if (gt goals.[0] goals.[1])}}
                        <strong>{{goals.[0]}}</strong> - {{goals.[1]}}
                    {{else}}
                        {{goals.[0]}} - <strong>{{goals.[1]}}</strong>
                    {{/if}}
                </td>
            </tr>
            {{/each}}
            {{else}}
            <tr>
                <td colspan="6" style="text-align: center;">Keine bisherigen Spiele</td>
            </tr>
            {{/if}}
        </tbody>
    </table>
    <hr>
    <h2 >Tore</h2>
    <table class="table table-bordered table-striped" style="width: auto; margin-left: 0;">
        <thead>
            <tr>
                <th>Tor</th>
                <th>Sp. i. T.</th>
                <th>Uhrzeit</th>
                <th>Spielminute</th>
                <th>Ergebnis</th>
                <th>Gegner</th>
                <th>Tor i. Sp</th>
                <th>Art</th>
                <th>Tor i. T.</th>
                <th>Sekt</th>
                <th>Spieler</th>
            </tr>
        </thead>
        <tbody>
            {{#if goals.length}}
            {{#each goals}}
            <tr>
                <td style="padding-left: 20px;">{{teamGoalIndex}}</td>
                <td style="padding-left: 20px;">{{gameIndex}}</td>
                <td style="padding-left: 20px;">{{formattedTimestamp}}</td>
                <td style="padding-left: 20px;">{{formatedgameTimestamp}}</td>
                <td style="padding-left: 20px;"><strong>{{newScore.[0]}}</strong> - {{newScore.[1]}}</td>
                <td style="padding-left: 20px;"><a href="/team/details/{{opponent.id}}" style="color: inherit;">{{opponent.name}}</a></td>
                <td style="padding-left: 20px;">{{goalIndex}}</td>
                <td style="padding-left: 20px;">{{gameDisplayName}}</td>
                <td style="padding-left: 20px;">{{goalIndexTournament}}</td>
                <td style="padding-left: 20px;">{{#if sekt_won}}Ja{{else}}Nein{{/if}}</td>
                <td style="padding-left: 20px;">{{playerName}}</td>
            </tr>
            {{/each}}
            {{else}}
            <tr>
                <td colspan="12" style="text-align: center;">Keine Tore vorhanden</td>
            </tr>
            {{/if}}
        </tbody>
    </table>
 <hr>
    <h2>Team Logo</h2>
    <form action='/team/uploadLogo' method="POST" enctype="multipart/form-data">
        <input type="hidden" name="_id" value="{{team._id}}">
        <div class="form-group">
            <label for="teamLogo">Team Logo hochladen:</label>
            <input type="file" class="form-control" id="teamLogo" name="teamLogo" accept="image/*" required>
        </div>
        <button type="submit" class="btn btn-primary">Logo hochladen</button>
    </form>
    <h3 class="mt-4">Aktuelles Logo:</h3>
    {{#if logoPath}}
        <div class="team-logo" style="background-color: #f8f9fa; padding: 30px; border-radius: 10px; max-width: 600px; margin: 0 auto;">
            <p class="text-muted mb-4 text-center"><i class="fa fa-info-circle"></i> <strong>Anleitung:</strong> Logo im Kreis an passende Position schieben und Größe anpassen</p>
            
            <!-- Logo Container - zentriert -->
            <div class="text-center mb-5" style="padding: 50px 60px;">
                <div style="position: relative; display: inline-block;">
                    <!-- Pfeil nach oben -->
                    <div style="position: absolute; top: -35px; left: 50%; transform: translateX(-50%);">
                        <button type="button" id="move-up" class="btn btn-outline-primary btn-sm" style="padding: 5px 10px;">
                            <i class="fa fa-arrow-up"></i>
                        </button>
                    </div>
                    
                    <!-- Pfeil nach links -->
                    <div style="position: absolute; top: 50%; left: -45px; transform: translateY(-50%);">
                        <button type="button" id="move-left" class="btn btn-outline-primary btn-sm" style="padding: 5px 10px;">
                            <i class="fa fa-arrow-left"></i>
                        </button>
                    </div>
                    
                    <!-- Pfeil nach rechts -->
                    <div style="position: absolute; top: 50%; right: -45px; transform: translateY(-50%);">
                        <button type="button" id="move-right" class="btn btn-outline-primary btn-sm" style="padding: 5px 10px;">
                            <i class="fa fa-arrow-right"></i>
                        </button>
                    </div>
                    
                    <!-- Pfeil nach unten -->
                    <div style="position: absolute; bottom: -35px; left: 50%; transform: translateX(-50%);">
                        <button type="button" id="move-down" class="btn btn-outline-primary btn-sm" style="padding: 5px 10px;">
                            <i class="fa fa-arrow-down"></i>
                        </button>
                    </div>
                    
                    <!-- Logo Container -->
                    <div id="logo-container" style="position: relative; width: 150px; height: 150px; border-radius: 50%; overflow: hidden; border: 3px solid #007bff; margin: 0 auto; background: {{#if team.logo.backgroundColor}}{{team.logo.backgroundColor}}{{else}}#f8f9fa{{/if}};">
                        <img id="team-logo-img" src="{{logoPath}}" alt="Team Logo" 
                             style="position: absolute; 
                                    transform-origin: center center;
                                    transform: translate(-50%, -50%) scale({{#if team.logo.scale}}{{team.logo.scale}}{{else}}1{{/if}});
                                    left: {{#if team.logo.position.x}}{{team.logo.position.x}}{{else}}50{{/if}}%;
                                    top: {{#if team.logo.position.y}}{{team.logo.position.y}}{{else}}50{{/if}}%;
                                    max-width: none;
                                    cursor: move;">
                    </div>
                </div>
            </div>
            
            <!-- Zentrieren Buttons -->
            <div class="text-center mb-4">
                <button type="button" id="center-horizontal" class="btn btn-outline-primary btn-sm mx-2">Horizontal zentrieren</button>
                <button type="button" id="center-vertical" class="btn btn-outline-primary btn-sm mx-2">Vertikal zentrieren</button>
            </div>
            
            <!-- Größe Regler -->
            <div class="text-center mb-4">
                <label for="logo-scale" class="form-label"><strong>Größe:</strong></label><br>
                <div style="display: inline-block; width: 300px;">
                    <input type="range" id="logo-scale" min="0.05" max="1.5" step="0.05" 
                           value="{{#if team.logo.scale}}{{team.logo.scale}}{{else}}1{{/if}}" 
                           class="form-range" style="width: 100%;">
                    <div class="text-center mt-1">
                        <span id="scale-value" style="font-weight: bold;">{{#if team.logo.scale}}{{team.logo.scale}}{{else}}1{{/if}}</span>
                    </div>
                </div>
            </div>
            
            <!-- Hintergrundfarbe -->
            <div class="text-center mb-4">
                <label for="background-color" class="form-label"><strong>Hintergrundfarbe:</strong></label><br>
                <input type="color" id="background-color" 
                       value="{{#if team.logo.backgroundColor}}{{team.logo.backgroundColor}}{{else}}#f8f9fa{{/if}}"
                       class="form-control" style="width: 100px; height: 40px; margin: 0 auto;">
            </div>
            
            <!-- Zurücksetzen und Speichern -->
            <div class="text-center mb-4">
                <button type="button" id="reset-logo" class="btn btn-secondary me-2">Zurücksetzen</button>
                <button type="button" id="save-logo-position" class="btn btn-success">Speichern</button>
            </div>
            
            <!-- Logo löschen -->
            <div class="text-center">
                <form action='/team/deleteLogo' method="POST" style="display: inline;">
                    <input type="hidden" name="_id" value="{{team._id}}">
                    <button type="submit" class="btn btn-danger">Logo löschen</button>
                </form>
            </div>
        </div>
        
        <script>
        let isDragging = false;
        let logoImg = document.getElementById('team-logo-img');
        let logoContainer = document.getElementById('logo-container');
        let scaleSlider = document.getElementById('logo-scale');
        let scaleValue = document.getElementById('scale-value');
        let backgroundColorPicker = document.getElementById('background-color');
        
        // Logo dragging functionality
        logoImg.addEventListener('mousedown', function(e) {
            isDragging = true;
            e.preventDefault();
        });
        
        document.addEventListener('mousemove', function(e) {
            if (isDragging) {
                let rect = logoContainer.getBoundingClientRect();
                let x = ((e.clientX - rect.left) / rect.width) * 100;
                let y = ((e.clientY - rect.top) / rect.height) * 100;
                
                // Begrenze die Position auf den Container
                x = Math.max(0, Math.min(100, x));
                y = Math.max(0, Math.min(100, y));
                
                logoImg.style.left = x + '%';
                logoImg.style.top = y + '%';
            }
        });
        
        document.addEventListener('mouseup', function() {
            isDragging = false;
        });
        
        // Scale functionality
        scaleSlider.addEventListener('input', function() {
            let scale = this.value;
            logoImg.style.transform = `translate(-50%, -50%) scale(${scale})`;
            scaleValue.textContent = scale;
        });
        
        // Background color functionality
        backgroundColorPicker.addEventListener('input', function() {
            logoContainer.style.backgroundColor = this.value;
        });
        
        // Center horizontally
        document.getElementById('center-horizontal').addEventListener('click', function() {
            logoImg.style.left = '50%';
        });
        
        // Center vertically  
        document.getElementById('center-vertical').addEventListener('click', function() {
            logoImg.style.top = '50%';
        });
        
        // Arrow movement functions
        function moveLogoByArrow(direction) {
            let currentLeft = parseFloat(logoImg.style.left) || 50;
            let currentTop = parseFloat(logoImg.style.top) || 50;
            let step = 2; // Bewegungsschritt in Prozent
            
            switch(direction) {
                case 'up':
                    currentTop = Math.max(0, currentTop - step);
                    logoImg.style.top = currentTop + '%';
                    break;
                case 'down':
                    currentTop = Math.min(100, currentTop + step);
                    logoImg.style.top = currentTop + '%';
                    break;
                case 'left':
                    currentLeft = Math.max(0, currentLeft - step);
                    logoImg.style.left = currentLeft + '%';
                    break;
                case 'right':
                    currentLeft = Math.min(100, currentLeft + step);
                    logoImg.style.left = currentLeft + '%';
                    break;
            }
        }
        
        // Arrow button event listeners
        document.getElementById('move-up').addEventListener('click', function() {
            moveLogoByArrow('up');
        });
        
        document.getElementById('move-down').addEventListener('click', function() {
            moveLogoByArrow('down');
        });
        
        document.getElementById('move-left').addEventListener('click', function() {
            moveLogoByArrow('left');
        });
        
        document.getElementById('move-right').addEventListener('click', function() {
            moveLogoByArrow('right');
        });
        
        // Reset functionality
        document.getElementById('reset-logo').addEventListener('click', function() {
            logoImg.style.left = '50%';
            logoImg.style.top = '50%';
            logoImg.style.transform = 'translate(-50%, -50%) scale(0.5)';
            scaleSlider.value = 0.5;
            scaleValue.textContent = '0.5';
            backgroundColorPicker.value = '#f8f9fa';
            logoContainer.style.backgroundColor = '#f8f9fa';
        });
        
        // Save functionality
        document.getElementById('save-logo-position').addEventListener('click', function() {
            let currentLeft = parseFloat(logoImg.style.left);
            let currentTop = parseFloat(logoImg.style.top);
            let currentScale = parseFloat(scaleSlider.value);
            let currentBackgroundColor = backgroundColorPicker.value;
            
            // Send AJAX request to save position
            fetch('/team/saveLogoPosition', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    teamId: '{{team._id}}',
                    x: currentLeft,
                    y: currentTop,
                    scale: currentScale,
                    backgroundColor: currentBackgroundColor
                })
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    alert('Logo-Einstellungen erfolgreich gespeichert!');
                } else {
                    alert('Fehler beim Speichern der Logo-Einstellungen.');
                }
            })
            .catch(error => {
                console.error('Error:', error);
                alert('Fehler beim Speichern der Logo-Einstellungen.');
            });
        });
        </script>
    {{else}}
        <p class="text-muted">Kein Logo vorhanden</p>
    {{/if}}

    <hr>
    <h2 >Team Bild</h2>
    <form action='/team/uploadImage' method="POST" enctype="multipart/form-data">
        <input type="hidden" name="_id" value="{{team._id}}">
        <div class="form-group">
            <label for="teamImage">Team Bild hochladen <strong>(Bitte im 4:3 Format)</strong>:</label>
            <input type="file" class="form-control" id="teamImage" name="teamImage" accept="image/*" required>
        </div>
        <button type="submit" class="btn btn-primary">Bild hochladen</button>
    </form>
    <h3 class="mt-4">Aktuelles Bild:</h3>
    {{#if imagePath}}
        <div class="team-image text-center">
            <img src="{{imagePath}}" alt="Team Bild" style="max-width: 50%; height: auto;">
            <form action='/team/deleteImage' method="POST" style="margin-top: 10px;">
                <input type="hidden" name="_id" value="{{team._id}}">
                <button type="submit" class="btn btn-danger">Bild löschen</button>
            </form>
        </div>
    {{/if}}


    <div class="text-center mt-4">
        <a href="/team/list" class="btn btn-secondary">Zurück zur Teamliste</a>
    </div>
</div>